{"version":3,"file":"submission_confirmation.min.js","sources":["../src/submission_confirmation.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * A javascript module to handle submission confirmation for quiz.\n *\n * @module    mod_aiquiz/submission_confirmation\n * @copyright 2022 Huong Nguyen <huongnv13@gmail.com>\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since     4.1\n */\n\nimport {saveCancelPromise} from 'core/notification';\nimport Prefetch from 'core/prefetch';\nimport Templates from 'core/templates';\nimport {get_string as getString} from 'core/str';\n\nconst SELECTOR = {\n    attemptSubmitButton: '.path-mod-aiquiz .btn-finishattempt button',\n    attemptSubmitForm: 'form#frm-finishattempt',\n};\n\nconst TEMPLATES = {\n    submissionConfirmation: 'mod_aiquiz/submission_confirmation',\n};\n\n/**\n * Shows a loading overlay while the submission is in progress.\n */\nconst showLoadingScreen = () => {\n    if (document.getElementById('loadingScreen')) {\n        return;\n    }\n\n    const loadingDiv = document.createElement('div');\n    loadingDiv.id = 'loadingScreen';\n    loadingDiv.style.display = 'flex';\n    loadingDiv.innerHTML = `\n        <div class=\"loading-content\">\n            <div class=\"spinner\"></div>\n            <h4>Loading...</h4>\n            <p>Please wait while the feedback is being generated</p>\n        </div>\n    `;\n\n    const style = document.createElement('style');\n    document.head.appendChild(style);\n    document.body.appendChild(loadingDiv);\n};\n\n/**\n * Register events for attempt submit button.\n * @param {int} unAnsweredQuestions Total number of un-answered questions\n */\nconst registerEventListeners = (unAnsweredQuestions) => {\n    const submitAction = document.querySelector(SELECTOR.attemptSubmitButton);\n    if (submitAction) {\n        submitAction.addEventListener('click', async(e) => {\n            e.preventDefault();\n            try {\n                await saveCancelPromise(\n                    getString('submission_confirmation', 'quiz'),\n                    Templates.render(TEMPLATES.submissionConfirmation, {\n                        hasunanswered: unAnsweredQuestions > 0,\n                        totalunanswered: unAnsweredQuestions\n                    }),\n                    getString('submitallandfinish', 'quiz')\n                );\n\n                showLoadingScreen();\n\n                submitAction.closest(SELECTOR.attemptSubmitForm).submit();\n\n            } catch {\n                console.log(\"Cancel submission\"); // eslint-disable-line no-console\n                return;\n            }\n        });\n    }\n};\n\n/**\n * Initialises.\n * @param {int} unAnsweredQuestions Total number of unanswered questions\n */\nexport const init = (unAnsweredQuestions) => {\n    Prefetch.prefetchStrings('core', ['submit']);\n    Prefetch.prefetchStrings('core_admin', ['confirmation']);\n    Prefetch.prefetchStrings('quiz', ['submitallandfinish', 'submission_confirmation']);\n    Prefetch.prefetchTemplate(TEMPLATES.submissionConfirmation);\n    registerEventListeners(unAnsweredQuestions);\n};\n"],"names":["SELECTOR","TEMPLATES","registerEventListeners","unAnsweredQuestions","submitAction","document","querySelector","addEventListener","async","e","preventDefault","Templates","render","hasunanswered","totalunanswered","getElementById","loadingDiv","createElement","id","style","display","innerHTML","head","appendChild","body","showLoadingScreen","closest","submit","console","log","prefetchStrings","prefetchTemplate"],"mappings":";;;;;;;;kLA6BMA,6BACmB,6CADnBA,2BAEiB,yBAGjBC,iCACsB,qCA+BtBC,uBAA0BC,4BACtBC,aAAeC,SAASC,cAAcN,8BACxCI,cACAA,aAAaG,iBAAiB,SAASC,MAAAA,IACnCC,EAAEC,2BAEQ,oCACF,mBAAU,0BAA2B,QACrCC,mBAAUC,OAAOX,iCAAkC,CAC/CY,cAAeV,oBAAsB,EACrCW,gBAAiBX,uBAErB,mBAAU,qBAAsB,SArC1B,SAClBE,SAASU,eAAe,8BAItBC,WAAaX,SAASY,cAAc,OAC1CD,WAAWE,GAAK,gBAChBF,WAAWG,MAAMC,QAAU,OAC3BJ,WAAWK,gOAQLF,MAAQd,SAASY,cAAc,SACrCZ,SAASiB,KAAKC,YAAYJ,OAC1Bd,SAASmB,KAAKD,YAAYP,aAsBdS,GAEArB,aAAasB,QAAQ1B,4BAA4B2B,SAEnD,kBACEC,QAAQC,IAAI,wCAWP1B,wCACR2B,gBAAgB,OAAQ,CAAC,6BACzBA,gBAAgB,aAAc,CAAC,mCAC/BA,gBAAgB,OAAQ,CAAC,qBAAsB,8CAC/CC,iBAAiB9B,kCAC1BC,uBAAuBC"}