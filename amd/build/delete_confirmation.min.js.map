{"version":3,"file":"delete_confirmation.min.js","sources":["../src/delete_confirmation.js"],"sourcesContent":["define(['jquery', 'core/modal_save_cancel', 'core/str'], function($, ModalSaveCancel, Str) {\n    return {\n        init: async function() {\n            // Listen for any click on a [data-action=\"delete\"] link.\n            // Use event delegation on document.\n            $(document).on('click', 'a[data-action=\"delete\"]', async function(e) {\n                // Identify the course-module container of this link.\n                const deleteLink = $(this);\n                const cmItem = deleteLink.closest('[data-for=\"cmitem\"]'); // the activity card\n                if (!cmItem.length) {\n                    return; // not on a course module item\n                }\n                // Check if this is our mod_aiquiz instance.\n                // The module name might appear in an icon class or data attributes.\n                // One robust way: get the course-module ID and ask the server.\n                const cmid = deleteLink.data('id');\n                if (!cmid) {\n                    return;\n                }\n\n                // For simplicity, assume we somehow know it's aiquiz;\n                // e.g. if you added a class on the cmitem: if (cmItem.hasClass('activity-mod_aiquiz')) { ... }\n                if (!cmItem.hasClass('activity-mod_aiquiz')) {\n                    return; // not an aiquiz, leave default behavior\n                }\n\n                // Prevent the default delete (and first modal).\n                e.preventDefault();\n\n                // **First confirmation modal (Delete aiquiz instance)**.\n                const title1 = await Str.get_string('deletemoduleconfirm', 'core'); // e.g. \"Confirm delete\"\n                const body1 = await Str.get_string('confirmdelete', 'mod_aiquiz');\n                // (You may define 'confirmdelete' in aiquiz.php language file as needed.)\n                const modal1 = await ModalSaveCancel.create({\n                    title: title1,\n                    body: body1\n                });\n                modal1.setSaveButtonText(await Str.get_string('yes', 'moodle'));\n                modal1.setCancelButtonText(await Str.get_string('no', 'moodle'));\n                modal1.on('save', async () => {\n                    modal1.hide();\n                    // **Second confirmation modal (Delete generated questions too)**.\n                    const title2 = await Str.get_string('confirmdeletequestions', 'mod_aiquiz');\n                    const body2 = await Str.get_string('deletequestionsbody', 'mod_aiquiz');\n                    const modal2 = await ModalSaveCancel.create({\n                        title: title2,\n                        body: body2\n                    });\n                    modal2.setSaveButtonText(await Str.get_string('yes', 'moodle'));\n                    modal2.setCancelButtonText(await Str.get_string('no', 'moodle'));\n                    modal2.on('save', () => {\n                        modal2.hide();\n                        // User confirmed both dialogs. Proceed with deletion.\n                        // If additional data (like \"delete questions\" flag) is needed, pass it via URL or a form.\n                        // Here we simply follow the original delete URL:\n                        window.location = deleteLink.attr('href');\n                    });\n                    modal2.show();\n                });\n                modal1.show();\n            });\n        }\n    };\n});\n"],"names":["define","$","ModalSaveCancel","Str","init","async","document","on","e","deleteLink","this","cmItem","closest","length","data","hasClass","preventDefault","title1","get_string","body1","modal1","create","title","body","setSaveButtonText","setCancelButtonText","hide","title2","body2","modal2","window","location","attr","show"],"mappings":"AAAAA,4CAAO,CAAC,SAAU,yBAA0B,aAAa,SAASC,EAAGC,gBAAiBC,WAC3E,CACHC,KAAMC,iBAGFJ,EAAEK,UAAUC,GAAG,QAAS,2BAA2BF,eAAeG,SAExDC,WAAaR,EAAES,MACfC,OAASF,WAAWG,QAAQ,2BAC7BD,OAAOE,kBAMCJ,WAAWK,KAAK,iBAOxBH,OAAOI,SAAS,kCAKrBP,EAAEQ,uBAGIC,aAAed,IAAIe,WAAW,sBAAuB,QACrDC,YAAchB,IAAIe,WAAW,gBAAiB,kBAE9CE,aAAelB,gBAAgBmB,OAAO,CACxCC,MAAOL,OACPM,KAAMJ,QAEVC,OAAOI,wBAAwBrB,IAAIe,WAAW,MAAO,WACrDE,OAAOK,0BAA0BtB,IAAIe,WAAW,KAAM,WACtDE,OAAOb,GAAG,QAAQF,UACde,OAAOM,aAEDC,aAAexB,IAAIe,WAAW,yBAA0B,kBACxDU,YAAczB,IAAIe,WAAW,sBAAuB,kBACpDW,aAAe3B,gBAAgBmB,OAAO,CACxCC,MAAOK,OACPJ,KAAMK,QAEVC,OAAOL,wBAAwBrB,IAAIe,WAAW,MAAO,WACrDW,OAAOJ,0BAA0BtB,IAAIe,WAAW,KAAM,WACtDW,OAAOtB,GAAG,QAAQ,KACdsB,OAAOH,OAIPI,OAAOC,SAAWtB,WAAWuB,KAAK,WAEtCH,OAAOI,UAEXb,OAAOa"}