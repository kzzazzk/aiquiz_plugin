{"version":3,"file":"doubleconfirm.min.js","sources":["../src/doubleconfirm.js"],"sourcesContent":["define([\n    'core/notification',\n    'core/modal_factory',\n    'core/ajax',\n    'jquery',\n], function (Notification, ModalFactory, Ajax, $) {\n    return {\n        // eslint-disable-next-line no-unused-vars\n        init: function (quizid, coursemodule) {\n            const originalConfirm = Notification.confirm;\n\n            Notification.confirm = function (title, message, yesLabel, noLabel, yesCallback, noCallback) {\n                const isaiquizDeletion = typeof message === 'string' &&\n                    message.startsWith('Are you sure that you want to delete the Assign Quiz');\n\n                if (!isaiquizDeletion) {\n                    return originalConfirm(title, message, yesLabel, noLabel, yesCallback, noCallback);\n                }\n\n                const wrappedYes = function () {\n                    ModalFactory.create({\n                        title: 'One last check!',\n                        body: 'Do you also want to delete the generated questions on this quiz?',\n                        type: ModalFactory.types.SAVE_CANCEL\n                    }).then(function (secondModal) {\n                        secondModal.show();\n\n                        const modalRoot = secondModal.getRoot();\n                        const saveBtn = modalRoot.find('.modal-footer .btn-primary');\n                        saveBtn.text('Yes, delete questions');\n\n                        const cancelBtn = modalRoot.find('.modal-footer .btn-secondary');\n                        cancelBtn.text('No, keep them');\n\n                        saveBtn.on('click', function () {\n                            secondModal.hide();\n                            if (typeof yesCallback === 'function') {\n                                yesCallback();\n                            }\n                        });\n\n                        cancelBtn.on('click', function () {\n                            secondModal.hide();\n\n                            // üîÅ Call AJAX to preserve questions\n                            Ajax.call([{\n                                methodname: 'mod_aiquiz_preserve_questions',\n                                args: {\n                                    quizid: quizid\n                                },\n                                fail: Notification.exception\n                            }]);\n\n                            // üåÄ Find and animate the activity deletion\n                            const activitySelector = `[id=\"module-${coursemodule}\"]`; // coursemodule must be passed into `init`\n                            const activityElement = document.querySelector(activitySelector);\n\n                            if (activityElement) {\n                                activityElement.classList.add('dimmed'); // optional visual cue\n                                $(activityElement).fadeOut(150, function () {\n                                    this.remove(); // remove from DOM after fade-out\n                                });\n                            }\n                        });\n\n\n                    }).catch(Notification.exception);\n                };\n\n                const wrappedNo = function() {\n                    if (typeof noCallback === 'function') {\n                        noCallback();\n                    }\n                };\n\n                return originalConfirm(title, message, yesLabel, noLabel, wrappedYes, wrappedNo);\n            };\n        }\n    };\n});\n"],"names":["define","Notification","ModalFactory","Ajax","$","init","quizid","coursemodule","originalConfirm","confirm","title","message","yesLabel","noLabel","yesCallback","noCallback","startsWith","create","body","type","types","SAVE_CANCEL","then","secondModal","show","modalRoot","getRoot","saveBtn","find","text","cancelBtn","on","hide","call","methodname","args","fail","exception","activitySelector","activityElement","document","querySelector","classList","add","fadeOut","remove","catch"],"mappings":"AAAAA,sCAAO,CACH,oBACA,qBACA,YACA,WACD,SAAUC,aAAcC,aAAcC,KAAMC,SACpC,CAEHC,KAAM,SAAUC,OAAQC,oBACdC,gBAAkBP,aAAaQ,QAErCR,aAAaQ,QAAU,SAAUC,MAAOC,QAASC,SAAUC,QAASC,YAAaC,iBAC7B,iBAAZJ,SAChCA,QAAQK,WAAW,gEAGZR,gBAAgBE,MAAOC,QAASC,SAAUC,QAASC,YAAaC,mBA2DpEP,gBAAgBE,MAAOC,QAASC,SAAUC,SAxD9B,WACfX,aAAae,OAAO,CAChBP,MAAO,kBACPQ,KAAM,mEACNC,KAAMjB,aAAakB,MAAMC,cAC1BC,MAAK,SAAUC,aACdA,YAAYC,aAENC,UAAYF,YAAYG,UACxBC,QAAUF,UAAUG,KAAK,8BAC/BD,QAAQE,KAAK,+BAEPC,UAAYL,UAAUG,KAAK,gCACjCE,UAAUD,KAAK,iBAEfF,QAAQI,GAAG,SAAS,WAChBR,YAAYS,OACe,mBAAhBlB,aACPA,iBAIRgB,UAAUC,GAAG,SAAS,WAClBR,YAAYS,OAGZ7B,KAAK8B,KAAK,CAAC,CACPC,WAAY,oCACZC,KAAM,CACF7B,OAAQA,QAEZ8B,KAAMnC,aAAaoC,mBAIjBC,uCAAkC/B,mBAClCgC,gBAAkBC,SAASC,cAAcH,kBAE3CC,kBACAA,gBAAgBG,UAAUC,IAAI,UAC9BvC,EAAEmC,iBAAiBK,QAAQ,KAAK,gBACvBC,mBAMlBC,MAAM7C,aAAaoC,cAGR,WACY,mBAAftB,YACPA"}